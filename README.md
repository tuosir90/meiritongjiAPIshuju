# API费用统计系统

一个功能完善、界面精美的每日API接口费用和图片生成统计管理系统。

## ✨ 核心功能

### 📊 数据管理
- **数据录入** - 手动录入每日各API接口费用和图片生成数量
- **批量编辑** - 支持编辑和删除历史记录
- **版本控制** - 自动检测服务器数据版本，智能同步最新数据
- **手动刷新** - 一键刷新按钮，强制从服务器同步数据

### 📈 数据可视化
- **统计卡片** - 累计总费用、累计图片数、平均每日费用、平均每日图片数、记录天数
- **费用趋势图** - 折线图展示各API费用变化趋势，支持按日/按月切换
- **图片生成量图表** - 柱状图展示图片生成数量，支持按日/按月切换
- **多视图切换** - 费用和图片图表独立切换，灵活对比

### 🔍 数据筛选
- **快速筛选** - 最近7天、最近30天、本月、上月
- **按月筛选** - 近12个月的月份快速选择
- **自定义日期** - 自由选择开始和结束日期
- **实时过滤** - 筛选结果实时反映在统计、图表和表格中

### 💾 数据导出
- **Excel导出** - 导出为.xlsx格式，包含完整数据和格式
- **CSV导出** - 导出为.csv格式，兼容各类数据分析工具
- **筛选导出** - 导出数据遵循当前日期筛选条件

### 🎨 精美界面
- **渐变设计** - 现代化渐变色彩方案
- **玻璃态效果** - 背景模糊和半透明效果
- **流畅动画** - 悬停、过渡、加载等动画效果
- **响应式布局** - 完美适配桌面端和移动端
- **深色模式** - 支持亮色/暗色主题无缝切换

## 🛠️ 技术栈

- **框架**: Next.js 15 (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS + 自定义渐变
- **UI组件**: shadcn/ui
- **图标**: Lucide React
- **表格**: TanStack Table (React Table)
- **图表**: Recharts
- **主题**: next-themes
- **数据导出**: xlsx
- **响应式**: react-responsive

## 🚀 快速开始

### Windows用户 - 一键启动工具

项目提供了两个便捷的批处理脚本：

**方式一：快速启动开发服务器**
- 双击 `dev.bat` 文件
- 自动检测并安装依赖（首次运行）
- 自动启动开发服务器

**方式二：项目管理工具（推荐）**
- 双击 `start.bat` 文件
- 提供菜单选项：
  - [1] 启动开发服务器
  - [2] 构建生产版本
  - [3] 预览构建结果
  - [4] 安装/更新依赖
  - [5] 运行代码检查
  - [6] 清理构建产物
  - [7] 清理并重新安装依赖

### 命令行方式

#### 安装依赖

```bash
npm install
```

#### 本地开发

```bash
npm run dev
```

打开浏览器访问 [http://localhost:3000](http://localhost:3000)

#### 构建生产版本

```bash
npm run build
```

#### 预览构建结果

```bash
npx serve out
```

## 📦 部署

### GitHub Pages

项目已配置GitHub Actions自动部署：

1. 将代码推送到GitHub仓库
2. 在仓库设置中启用GitHub Pages
3. 选择GitHub Actions作为部署源
4. 推送到main分支会自动触发部署

**重要配置**：`next.config.ts` 中已配置 `basePath` 用于GitHub Pages子目录部署。

### 其他平台

项目已配置为静态导出（`output: 'export'`），可以部署到任何支持静态网站的平台：

- Vercel
- Netlify
- Cloudflare Pages
- 自建服务器

## 💡 使用说明

### 快速体验

1. 点击顶部**"生成测试数据"**按钮
2. 确认后自动生成30天的模拟记录
3. 页面刷新后即可看到完整数据和图表

### 添加记录

1. 点击**"添加记录"**按钮
2. 选择日期
3. 输入各API的费用（元）
4. 输入生成的图片总数
5. 可选：添加备注信息
6. 点击**"保存"**按钮

### 日期筛选

**方式一：快速筛选**
- 点击顶部**日历图标**按钮
- 选择预设范围：最近7天、最近30天、本月、上月

**方式二：按月筛选**
- 在筛选对话框中选择**"按月选择"**区域
- 点击任意月份快速筛选该月数据

**方式三：自定义日期**
- 在筛选对话框中选择**"自定义日期范围"**
- 分别选择开始日期和结束日期
- 点击**"应用自定义范围"**

**清除筛选**
- 点击筛选按钮上的❌图标
- 或在对话框中点击**"清除筛选"**

### 查看图表

**费用趋势图**
- **按日视图**：显示每日各API费用变化曲线
- **按月视图**：显示每月各API费用汇总曲线
- 点击右上角切换按钮切换视图模式

**图片生成量图表**
- **按日视图**：显示每日图片生成数量柱状图
- **按月视图**：显示每月图片生成总量柱状图
- 独立切换，不影响费用图表视图

### 查看统计

五个统计卡片实时更新：
- **累计总费用** - 所有记录的费用总和
- **累计图片数** - 所有记录的图片总数
- **平均每日费用** - 总费用除以天数
- **平均每日图片** - 总图片数除以天数
- **记录天数** - 已记录的天数

### 管理记录

- **编辑**：点击记录行的✏️按钮，修改后保存
- **删除**：点击🗑️按钮，确认后删除记录
- **排序**：点击表头可以按日期、费用等排序

### 导出数据

- **导出Excel**：点击**"导出Excel"**按钮，下载.xlsx文件
- **导出CSV**：点击**"导出CSV"**按钮，下载.csv文件
- 导出的数据会遵循当前的日期筛选条件

### 清除数据

- 点击顶部**"清除所有数据"**按钮
- 确认后将删除所有记录（⚠️不可恢复）
- 建议清除前先导出备份

### 主题切换

点击右上角的🌓主题切换按钮，在亮色和暗色模式之间切换。

## 📝 数据更新指南（重要）

### 🎯 更新流程概述

本系统支持通过更新 JSON 文件来推送新数据到所有用户，用户访问时会自动检测版本并同步最新数据。

---

### ⚡ 快速更新步骤

#### 步骤1：编辑数据文件

打开 `public/initial-data.json` 文件：

```json
{
  "version": "1.0.0",          // ⚠️ 必须修改版本号
  "lastUpdated": "2025-11-15T09:00:00Z",
  "apis": [...],
  "records": [
    {
      "id": "2025-11-16-1",    // 唯一ID
      "date": "2025-11-16",    // ISO格式日期
      "apiCosts": [
        { "apiId": "volcengine", "cost": 3.6 },
        { "apiId": "yunwu", "cost": 10 },
        { "apiId": "tangguo", "cost": 25 }
      ],
      "imageCount": 978,       // 生图数量
      "totalCost": 38.6       // 总费用（必须等于所有apiCosts之和）
    }
  ]
}
```

#### 步骤2：更新版本号

**版本号规则**（语义化版本）：
- **主版本.次版本.修订号** (如 1.0.0)
- 新增数据记录：增加修订号 `1.0.0 → 1.0.1`
- 修改数据结构：增加次版本号 `1.0.0 → 1.1.0`
- 重大变更：增加主版本号 `1.0.0 → 2.0.0`

**示例：**
```json
{
  "version": "1.0.1",  // ✅ 从 1.0.0 改为 1.0.1
  "lastUpdated": "2025-11-16T10:30:00Z",  // 更新时间
  ...
}
```

#### 步骤3：提交并推送

```bash
# 添加更改
git add public/initial-data.json

# 提交（建议说明更新内容）
git commit -m "chore: update data to v1.0.1 - add 2025-11-16 record"

# 推送到GitHub
git push
```

#### 步骤4：等待部署

- GitHub Actions 会自动部署（约1-2分钟）
- 部署完成后，用户访问页面会自动检测新版本
- 自动同步最新数据

---

### 📋 数据格式详解

#### 记录字段说明

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| `id` | string | ✅ | 唯一标识符 | "2025-11-16-1" |
| `date` | string | ✅ | ISO格式日期 | "2025-11-16" |
| `apiCosts` | array | ✅ | API费用数组 | 见下方 |
| `imageCount` | number | ✅ | 生图总数 | 978 |
| `totalCost` | number | ✅ | 总费用 | 38.6 |
| `notes` | string | ❌ | 备注信息 | "特殊活动" |

#### API费用对象

```json
{
  "apiId": "volcengine",  // API ID（必须在apis列表中）
  "cost": 3.6            // 费用（元）
}
```

#### 完整记录示例

```json
{
  "id": "2025-11-16-1",
  "date": "2025-11-16",
  "apiCosts": [
    { "apiId": "volcengine", "cost": 3.6 },
    { "apiId": "yunwu", "cost": 10 },
    { "apiId": "tangguo", "cost": 25 }
  ],
  "imageCount": 978,
  "totalCost": 38.6,
  "notes": "正常运营数据"
}
```

---

### ✅ 数据校验清单

在提交前请检查：

- [ ] **版本号已更新**（比当前版本大）
- [ ] **日期格式正确**（YYYY-MM-DD）
- [ ] **记录ID唯一**（格式：日期-序号）
- [ ] **totalCost正确**（等于所有apiCosts之和）
- [ ] **apiId存在**（在apis列表中）
- [ ] **费用为数字**（不能有引号）
- [ ] **JSON格式有效**（无语法错误）
- [ ] **记录按日期降序**（最新日期在前）

---

### 🛠️ 常用操作

#### 添加单条记录

```json
{
  "version": "1.0.1",  // 版本号 +0.0.1
  "records": [
    {
      "id": "2025-11-16-1",  // 新记录
      "date": "2025-11-16",
      "apiCosts": [...],
      "imageCount": 978,
      "totalCost": 38.6
    },
    // ... 已有记录保持不变
  ]
}
```

#### 修改已有记录

```json
{
  "version": "1.0.1",  // 版本号 +0.0.1
  "records": [
    {
      "id": "2025-11-15-1",
      "date": "2025-11-15",
      "apiCosts": [
        { "apiId": "volcengine", "cost": 5.0 }  // ✏️ 修改费用
      ],
      "imageCount": 1000,  // ✏️ 修改数量
      "totalCost": 40.0    // ✏️ 更新总费用
    }
  ]
}
```

#### 批量添加多天数据

```json
{
  "version": "1.1.0",  // 批量更新，次版本号 +1
  "records": [
    { "id": "2025-11-18-1", "date": "2025-11-18", ... },
    { "id": "2025-11-17-1", "date": "2025-11-17", ... },
    { "id": "2025-11-16-1", "date": "2025-11-16", ... }
  ]
}
```

---

### ⚠️ 注意事项

#### 1. 版本号必须递增
```json
// ❌ 错误：版本号未变
"version": "1.0.0"  → "version": "1.0.0"

// ✅ 正确：版本号递增
"version": "1.0.0"  → "version": "1.0.1"
```

#### 2. 总费用必须匹配
```json
// ❌ 错误：总费用不等于各API之和
"apiCosts": [
  { "apiId": "volcengine", "cost": 3.6 },
  { "apiId": "yunwu", "cost": 10 }
],
"totalCost": 20  // 错误！应该是 13.6

// ✅ 正确
"totalCost": 13.6
```

#### 3. 日期必须唯一
```json
// ❌ 错误：同一天有两条记录
[
  { "id": "2025-11-16-1", "date": "2025-11-16", ... },
  { "id": "2025-11-16-2", "date": "2025-11-16", ... }
]

// ✅ 正确：每天一条记录（或合并数据）
[
  { "id": "2025-11-16-1", "date": "2025-11-16", ... }
]
```

#### 4. JSON格式检查

使用在线工具验证 JSON 格式：
- https://jsonlint.com/
- VSCode 自动格式化（Shift + Alt + F）

---

### 🔍 用户端查看更新

用户有两种方式获取更新：

#### 自动检测（推荐）
- 用户访问页面时自动检查版本
- 检测到新版本自动下载并更新
- 控制台显示：`✅ 检测到新版本，从 xxx 加载数据`

#### 手动刷新
- 点击页面顶部"刷新数据"按钮
- 强制从服务器获取最新数据
- 显示刷新成功/失败消息

---

### 📊 数据更新示例

#### 场景1：每日例行更新

```json
{
  "version": "1.0.5",  // 从 1.0.4 → 1.0.5
  "lastUpdated": "2025-11-16T08:00:00Z",
  "records": [
    {
      "id": "2025-11-16-1",
      "date": "2025-11-16",
      "apiCosts": [
        { "apiId": "volcengine", "cost": 4.2 },
        { "apiId": "yunwu", "cost": 12 },
        { "apiId": "tangguo", "cost": 28 }
      ],
      "imageCount": 1050,
      "totalCost": 44.2
    },
    // ... 保留之前的记录
  ]
}
```

**提交命令：**
```bash
git add public/initial-data.json
git commit -m "chore: update data to v1.0.5 - 2025-11-16 daily report"
git push
```

---

### 🚨 常见错误及解决

#### 错误1：用户看不到更新
**原因：** 版本号未更新
**解决：** 确保修改了 `version` 字段

#### 错误2：数据格式错误
**原因：** JSON 语法错误
**解决：** 使用 jsonlint.com 验证格式

#### 错误3：总费用不匹配
**原因：** totalCost 未手动更新
**解决：** 确保 totalCost = 所有 apiCosts 之和

#### 错误4：推送后无效
**原因：** GitHub Actions 部署失败
**解决：** 检查仓库 Actions 标签页查看部署日志

---

### 💡 最佳实践

1. **每日更新**：建议每天固定时间更新数据
2. **版本递增**：每次更新只增加修订号（第三位）
3. **数据校验**：更新前使用 JSON 校验工具
4. **提交说明**：commit 信息包含日期和版本号
5. **备份数据**：重大更新前备份 JSON 文件

---

## 📁 项目结构

```
├── app/                    # Next.js App Router
│   ├── layout.tsx         # 根布局
│   ├── page.tsx           # 首页
│   └── globals.css        # 全局样式（自定义滚动条、渐变）
├── components/            # React组件
│   ├── ui/               # shadcn/ui基础组件
│   ├── dashboard.tsx     # 主仪表板（集成筛选）
│   ├── record-form.tsx   # 数据录入表单
│   ├── records-table.tsx # 数据表格
│   ├── stats-cards.tsx   # 统计卡片（渐变美化）
│   ├── cost-chart.tsx    # 图表组件（按日/按月切换）
│   ├── date-filter.tsx   # 日期筛选组件（新增）
│   └── theme-toggle.tsx  # 主题切换
├── hooks/                 # 自定义Hooks
│   └── use-app-data.ts   # 数据管理Hook
├── lib/                   # 工具库
│   ├── types.ts          # TypeScript类型定义
│   ├── storage.ts        # 本地存储
│   ├── export.ts         # 数据导出
│   ├── generate-test-data.ts  # 测试数据生成
│   └── utils.ts          # 工具函数
├── public/                # 静态资源
├── next.config.ts         # Next.js配置（GitHub Pages basePath）
└── CLAUDE.md             # Claude Code 上下文文档
```

## 🎨 自定义配置

### 修改默认API列表

编辑 `lib/storage.ts` 文件中的 `DEFAULT_APIS` 常量：

```typescript
const DEFAULT_APIS: ApiConfig[] = [
  { id: "volcengine", name: "火山引擎（字节跳动）", color: "#0052D9" },
  { id: "yunwu", name: "云雾API", color: "#00b96b" },
  { id: "tangguo", name: "糖果姐姐API", color: "#ff5c93" },
  { id: "your-api", name: "Your API", color: "#your-color" },
];
```

### 修改测试数据参数

编辑 `lib/generate-test-data.ts` 文件：

```typescript
// 每日总费用范围（元）
const targetTotal = 50 + Math.random() * 10; // 50-60元

// 每日图片生成数量
const imageCount = Math.floor(Math.random() * 501) + 1000; // 1000-1500张

// 生成数据天数
for (let i = 29; i >= 0; i--) { // 30天
```

### 修改主题颜色

编辑 `app/globals.css` 文件中的CSS变量和渐变类。

## 📄 数据存储

数据使用浏览器的 `localStorage` 存储，仅保存在本地，不会上传到服务器。

- **存储键**: `api-cost-tracker-data-v2`
- **优点**: 简单、快速、隐私保护
- **注意**: 清除浏览器数据会丢失记录
- **建议**: 定期使用导出功能备份数据

## 🎯 最佳实践

1. **每日录入**：养成每日记录的习惯，确保数据完整
2. **定期导出**：建议每周导出一次Excel备份
3. **使用筛选**：利用日期筛选功能分析特定时段的费用趋势
4. **对比视图**：使用按日/按月视图切换，从不同维度分析数据
5. **测试功能**：初次使用时先生成测试数据，熟悉系统功能

## ❓ 常见问题

**Q: 数据会丢失吗？**
A: 数据存储在浏览器localStorage中，除非手动清除浏览器数据或点击"清除所有数据"，否则数据会一直保留。建议定期导出备份。

**Q: 可以在不同设备间同步吗？**
A: 当前版本仅支持本地存储，不同设备间不会自动同步。可以通过导出/导入功能手动迁移数据。

**Q: 如何修改API列表？**
A: 编辑 `lib/storage.ts` 文件中的 `DEFAULT_APIS` 常量，然后重新构建部署。

**Q: GitHub Pages部署后显示404？**
A: 确保 `next.config.ts` 中的 `basePath` 与你的仓库名称一致。

**Q: 图表显示不完整？**
A: 尝试调整浏览器窗口大小，或在按日/按月视图之间切换，系统会自动适配。

## 📊 数据统计

测试数据参数（可自定义）：
- 📅 生成天数：30天
- 💰 每日费用：50-60元
- 🖼️ 每日图片：1000-1500张
- 📈 API数量：3个（可扩展）

## 🔄 更新日志

### v2.0.0 (最新)
- ✨ 新增日期筛选功能（快速筛选、按月筛选、自定义范围）
- ✨ 新增按月汇总图表视图
- ✨ 新增平均每日图片数统计
- ✨ 新增清除所有数据功能
- 🎨 全面美化UI（渐变、阴影、动画、玻璃态）
- 🎨 优化测试数据生成参数
- 🔧 修复GitHub Pages部署问题
- 🔧 优化响应式布局

### v1.0.0
- 🎉 初始版本发布
- ✅ 基础数据录入和展示
- ✅ 图表可视化
- ✅ 数据导出功能
- ✅ 深色模式支持

## 🤝 贡献

欢迎提交Issue和Pull Request！

如需新增功能或报告问题，请访问 [GitHub Issues](https://github.com/your-username/meiritongjiAPIshuju/issues)

## 📝 许可证

MIT License

---

💡 **提示**：首次使用建议点击"生成测试数据"按钮，快速体验系统所有功能！
